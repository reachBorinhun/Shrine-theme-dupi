{% comment %}
  Section: Full Screen Intro Gate
  - A full-screen, fixed position section that acts as an entry gate to the site.
  - Features a dynamic background image, logo, and customizable button text.
  - On click, it smoothly transitions away to reveal the main page content.
  - Styled with Tailwind CSS utility classes.
{% endcomment %}

{%- liquid
  assign bg_image = section.settings.background_image
  assign logo_image = section.settings.logo_image
  assign button_text = section.settings.button_text | escape
-%}

<style>
  /* Scoped styles for dynamic background and animations */
  #intro-gate-{{ section.id }} {
    {% if bg_image != blank %}
      /* Uses the image selected in the theme editor */
      background-image: url('{{ bg_image | image_url: width: 1920 }}');
      background-attachment: fixed;
    {% else %}
      /* Fallback solid color if no image is selected */
      background-color: #000000;
    {% endif %}
  }

  /* Custom text-shadow for better readability over complex backgrounds */
  .intro-gate-content-{{ section.id }} {
    text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.7);
    color: #ffffff; /* ensure text is white for contrast */
  }

  /* Force white for all text inside the gate to override other theme rules */
  #intro-gate-{{ section.id }},
  #intro-gate-{{ section.id }} * {
    color: #ffffff !important;
  }

  /* The 'color run' or 'shine' effect for the button */
  .shine-button {
    position: relative; /* Required for pseudo-element positioning */
    overflow: hidden;   /* Keeps the shine effect within the button bounds */
  }

  .shine-button::after {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    /* A subtle white gradient that creates the shine */
    background: linear-gradient(to right, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.4) 50%, rgba(255, 255, 255, 0) 100%);
    transform: translateX(-100%);
    /* The animation definition */
    animation: shine-effect 3.5s infinite linear;
  }

  @keyframes shine-effect {
    0% {
      transform: translateX(-100%);
    }
    100% {
      transform: translateX(100%);
    }
  }

  /* This class is added via JavaScript to prevent the main page from scrolling while the gate is active */
  body.intro-gate-active {
    overflow: hidden;
  }
</style>

<div
  id="intro-gate-{{ section.id }}"
  class="fixed top-0 left-0 w-screen h-screen bg-cover bg-center z-[100] flex justify-center items-end transition-transform duration-[800ms] ease-[cubic-bezier(0.76,0,0.24,1)]"
>
  <div class="intro-gate-content-{{ section.id }} text-center text-white pb-[8vh]">
    {% if logo_image != blank %}
      {{
        logo_image
        | image_url: width: 240
        | image_tag:
          class: 'mx-auto w-[120px] h-auto mb-5 drop-shadow-lg',
          loading: 'eager',
          width: logo_image.width,
          height: logo_image.height,
          alt: logo_image.alt
        | default: 'Logo'
      }}
    {% else %}
      <div class="mx-auto w-[120px] h-[120px] mb-5 bg-white/10 rounded-full flex items-center justify-center border border-white/20">
        <span class="text-xs uppercase">Logo</span>
      </div>
    {% endif %}

    {% if button_text != blank %}
      <button
        id="enter-button-{{ section.id }}"
        type="button"
        class="text-xl font-medium text-white tracking-wider cursor-pointer shine-button animate-pulse px-4 py-2 focus:outline-none focus:ring-4 focus:ring-white/30"
        aria-label="Enter site"
      >
        {{ button_text }}
      </button>
    {% endif %}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const introGate = document.getElementById('intro-gate-{{ section.id }}');
    const enterButton = document.getElementById('enter-button-{{ section.id }}');
    const body = document.body;

    // Ensure the required elements exist before running the script
    if (!introGate || !enterButton) {
      console.warn('Intro Gate section elements not found.');
      return;
    }

    // Add class to body to disable scrolling while the intro gate is visible
    body.classList.add('intro-gate-active');

    const hideIntroGate = () => {
      // 1. Add the Tailwind class to trigger the slide-up animation (-translate-y-full moves it 100% up)
      introGate.classList.add('-translate-y-full');

      // 2. Listen for the CSS transition to complete
      introGate.addEventListener(
        'transitionend',
        () => {
          // 3. Remove the class from the body to re-enable page scrolling
          body.classList.remove('intro-gate-active');

          // 4. Hide the intro gate completely so it doesn't affect the layout or intercept clicks
          introGate.style.display = 'none';
        },
        { once: true }
      ); // The { once: true } option automatically removes the event listener after it runs
    };

    enterButton.addEventListener('click', hideIntroGate);
    // Support keyboard activation (Enter / Space)
    enterButton.addEventListener('keydown', (event) => {
      if (event.key === 'Enter' || event.key === ' ') {
        event.preventDefault();
        hideIntroGate();
      }
    });
  });
</script>

{% schema %}
{
  "name": "Full Screen Intro Gate",
  "settings": [
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background Image",
      "info": "Choose a high-resolution background image for the intro gate."
    },
    {
      "type": "image_picker",
      "id": "logo_image",
      "label": "Logo Image",
      "info": "This logo will be displayed at the bottom-center of the screen."
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "\"Click to Start\" Text",
      "default": "Click to Start"
    }
  ],
  "presets": [
    {
      "name": "Full Screen Intro Gate"
    }
  ],
  "enabled_on": {
    "templates": ["index"]
  }
}
{% endschema %}
